#include "timer.h"

// Función para inicializar el temporizador
void init_timer(void) {
    // Configurar el temporizador para que cuente hacia abajo desde el valor de carga
    IOWR_ALTERA_AVALON_TIMER_PERIODL(TIMER_BASE, (alt_u16)(TIMER_LOAD_VALUE & 0xFFFF));
    IOWR_ALTERA_AVALON_TIMER_PERIODH(TIMER_BASE, (alt_u16)((TIMER_LOAD_VALUE >> 16) & 0xFFFF));

    // Configurar el temporizador para que genere una interrupción periódica
    IOWR_ALTERA_AVALON_TIMER_CONTROL(TIMER_BASE, ALTERA_AVALON_TIMER_CONTROL_CONT_MSK | ALTERA_AVALON_TIMER_CONTROL_START_MSK);
}

// Función para actualizar el reloj
void update_clock(Clock *clock) {
    // Actualizar los segundos
    clock->seconds++;
    if (clock->seconds >= 60) {
        clock->seconds = 0;
        clock->minutes++;
        if (clock->minutes >= 60) {
            clock->minutes = 0;
            clock->hours++;
            if (clock->hours >= 24) {
                clock->hours = 0;
            }
        }
    }
}
